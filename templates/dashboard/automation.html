{% extends "dashboard/base_dashboard.html" %}

{% block title %}Automatisation - WeBox{% endblock %}

{% block extra_css %}
<style>
/* ==================== MODAL CSS ==================== */
#createWorkflowModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.7);
    z-index: 99999;
    padding: 2rem;
    overflow-y: auto;
}

#createWorkflowModal.modal-open {
    display: flex;
    align-items: center;
    justify-content: center;
}

#createWorkflowModal .modal-content {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    position: relative;
}

#createWorkflowModal .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #e0e0e0;
}

#createWorkflowModal .modal-close {
    background: none;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    color: #666;
    line-height: 1;
    padding: 0;
    width: 32px;
    height: 32px;
}

#createWorkflowModal .modal-close:hover {
    color: #000;
}
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <h1>‚ö° Automatisation (Pipedream)</h1>
    <p>Cr√©ez des workflows automatis√©s puissants</p>
</div>

<!-- Pr√©sentation Pipedream -->
<div class="dashboard-card" style="background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%); color: white;">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: center;">
        <div>
            <h2 style="font-size: 2rem; margin-bottom: 1rem;">üöÄ Pipedream Integration</h2>
            <p style="opacity: 0.9; margin-bottom: 1.5rem;">
                Connectez WeBox √† plus de 1000 applications et automatisez vos t√¢ches r√©p√©titives sans code.
            </p>
            <div style="display: flex; gap: 1rem;">
                <button class="sidebar-btn primary" onclick="openCreateWorkflowModal()">‚ûï Cr√©er un workflow</button>
                <button class="sidebar-btn" style="background: white; color: #1a1a2e; border: none;" onclick="window.open('https://pipedream.com', '_blank')">üîó Ouvrir Pipedream</button>
            </div>
        </div>
        <div style="background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 10px; text-align: center;">
            <div style="font-size: 5rem;">‚ö°</div>
        </div>
    </div>
</div>

<!-- Statistiques -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
    <div class="dashboard-card" style="text-align: center;">
        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üìä</div>
        <div style="font-size: 2rem; font-weight: bold; color: #4169e1; margin-bottom: 0.5rem;">23</div>
        <div style="color: #666;">Workflows actifs</div>
    </div>
    <div class="dashboard-card" style="text-align: center;">
        <div style="font-size: 3rem; margin-bottom: 0.5rem;">‚ö°</div>
        <div style="font-size: 2rem; font-weight: bold; color: #28a745; margin-bottom: 0.5rem;">1,247</div>
        <div style="color: #666;">Ex√©cutions ce mois</div>
    </div>
    <div class="dashboard-card" style="text-align: center;">
        <div style="font-size: 3rem; margin-bottom: 0.5rem;">‚úÖ</div>
        <div style="font-size: 2rem; font-weight: bold; color: #ffc107; margin-bottom: 0.5rem;">98.5%</div>
        <div style="color: #666;">Taux de succ√®s</div>
    </div>
    <div class="dashboard-card" style="text-align: center;">
        <div style="font-size: 3rem; margin-bottom: 0.5rem;">‚è±Ô∏è</div>
        <div style="font-size: 2rem; font-weight: bold; color: #dc3545; margin-bottom: 0.5rem;">47h</div>
        <div style="color: #666;">Temps √©conomis√©</div>
    </div>
</div>

<!-- Workflows populaires -->
<div class="dashboard-card">
    <h2 style="margin-bottom: 1.5rem;">üî• Workflows Populaires</h2>
    <div style="display: grid; gap: 1rem;">
        <div style="padding: 1.5rem; background: #f8f9fa; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div style="font-size: 2rem;">üìß</div>
                <div>
                    <div style="font-weight: 600; color: #1a1a2e; margin-bottom: 0.25rem;">R√©sum√© Email Quotidien</div>
                    <div style="color: #666; font-size: 0.9rem;">R√©sume vos emails importants chaque matin</div>
                </div>
            </div>
            <button class="sidebar-btn" onclick="voirWorkflow('R√©sum√© Email')">Voir</button>
        </div>

        <div style="padding: 1.5rem; background: #f8f9fa; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div style="font-size: 2rem;">üì±</div>
                <div>
                    <div style="font-weight: 600; color: #1a1a2e; margin-bottom: 0.25rem;">Publication R√©seaux Sociaux</div>
                    <div style="color: #666; font-size: 0.9rem;">Publie automatiquement sur Twitter, LinkedIn, Facebook</div>
                </div>
            </div>
            <button class="sidebar-btn" onclick="voirWorkflow('Publication R√©seaux')">Voir</button>
        </div>

        <div style="padding: 1.5rem; background: #f8f9fa; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div style="font-size: 2rem;">üìä</div>
                <div>
                    <div style="font-weight: 600; color: #1a1a2e; margin-bottom: 0.25rem;">Rapport Analytics Hebdomadaire</div>
                    <div style="color: #666; font-size: 0.9rem;">Compile vos statistiques et envoie un rapport PDF</div>
                </div>
            </div>
            <button class="sidebar-btn" onclick="voirWorkflow('Rapport Analytics')">Voir</button>
        </div>

        <div style="padding: 1.5rem; background: #f8f9fa; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div style="font-size: 2rem;">ü§ñ</div>
                <div>
                    <div style="font-weight: 600; color: #1a1a2e; margin-bottom: 0.25rem;">Chatbot Support Client</div>
                    <div style="color: #666; font-size: 0.9rem;">R√©pond automatiquement aux questions fr√©quentes</div>
                </div>
            </div>
            <button class="sidebar-btn" onclick="voirWorkflow('Chatbot Support')">Voir</button>
        </div>

        <div style="padding: 1.5rem; background: #f8f9fa; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div style="font-size: 2rem;">üé®</div>
                <div>
                    <div style="font-weight: 600; color: #1a1a2e; margin-bottom: 0.25rem;">G√©n√©ration de Visuels</div>
                    <div style="color: #666; font-size: 0.9rem;">Cr√©e des images pour vos articles de blog</div>
                </div>
            </div>
            <button class="sidebar-btn" onclick="voirWorkflow('G√©n√©ration Visuels')">Voir</button>
        </div>
    </div>
</div>

<!-- Cas d'usage d√©taill√©s -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
    <div class="dashboard-card">
        <div style="font-size: 3rem; margin-bottom: 1rem;">üíº</div>
        <h3>Marketing Automation</h3>
        <p style="color: #666; line-height: 1.6; margin-bottom: 1rem;">
            Automatisez vos campagnes marketing, g√©n√©ration de leads, et suivi des conversions.
        </p>
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; font-size: 0.9rem;">
            <strong>Exemples :</strong><br>
            ‚Ä¢ Publication auto sur r√©seaux sociaux<br>
            ‚Ä¢ Emails de bienvenue personnalis√©s<br>
            ‚Ä¢ Scoring automatique des leads
        </div>
    </div>

    <div class="dashboard-card">
        <div style="font-size: 3rem; margin-bottom: 1rem;">üìà</div>
        <h3>Data Processing</h3>
        <p style="color: #666; line-height: 1.6; margin-bottom: 1rem;">
            Traitez et analysez vos donn√©es automatiquement, cr√©ez des rapports et dashboards.
        </p>
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; font-size: 0.9rem;">
            <strong>Exemples :</strong><br>
            ‚Ä¢ Rapports hebdomadaires automatiques<br>
            ‚Ä¢ Synchronisation multi-bases de donn√©es<br>
            ‚Ä¢ Nettoyage et enrichissement de donn√©es
        </div>
    </div>

    <div class="dashboard-card">
        <div style="font-size: 3rem; margin-bottom: 1rem;">üîî</div>
        <h3>Notifications & Alertes</h3>
        <p style="color: #666; line-height: 1.6; margin-bottom: 1rem;">
            Recevez des notifications intelligentes sur Slack, Discord, Email, SMS.
        </p>
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; font-size: 0.9rem;">
            <strong>Exemples :</strong><br>
            ‚Ä¢ Alertes de vente en temps r√©el<br>
            ‚Ä¢ Monitoring serveurs et applications<br>
            ‚Ä¢ Rappels de t√¢ches importantes
        </div>
    </div>
</div>

<!-- Int√©grations populaires -->
<div class="dashboard-card" style="margin-top: 2rem;">
    <h2 style="margin-bottom: 1.5rem;">üîå Int√©grations Populaires (1000+ apps)</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìß</div>
            <strong>Gmail</strong>
        </div>
        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üí¨</div>
            <strong>Slack</strong>
        </div>
        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìä</div>
            <strong>Google Sheets</strong>
        </div>
        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üê¶</div>
            <strong>Twitter</strong>
        </div>
        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üíº</div>
            <strong>LinkedIn</strong>
        </div>
        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üì±</div>
            <strong>Telegram</strong>
        </div>
        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üóÑÔ∏è</div>
            <strong>Airtable</strong>
        </div>
        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üõí</div>
            <strong>Shopify</strong>
        </div>
    </div>
</div>

<!-- Triggers disponibles -->
<div class="dashboard-card" style="margin-top: 2rem; background: #e3f2fd;">
    <h2 style="margin-bottom: 1.5rem;">‚ö° Types de Triggers (D√©clencheurs)</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
        <div style="padding: 1rem; background: white; border-radius: 8px;">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üåê</div>
            <strong>Webhook</strong>
            <p style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">D√©clench√© par une requ√™te HTTP</p>
        </div>
        <div style="padding: 1rem; background: white; border-radius: 8px;">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚è∞</div>
            <strong>Cron / Schedule</strong>
            <p style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">Ex√©cution programm√©e (quotidien, hebdo...)</p>
        </div>
        <div style="padding: 1rem; background: white; border-radius: 8px;">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üìß</div>
            <strong>Email</strong>
            <p style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">√Ä la r√©ception d'un email</p>
        </div>
        <div style="padding: 1rem; background: white; border-radius: 8px;">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üìù</div>
            <strong>Form Submit</strong>
            <p style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">Soumission de formulaire</p>
        </div>
        <div style="padding: 1rem; background: white; border-radius: 8px;">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üìä</div>
            <strong>Database Change</strong>
            <p style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">Modification en base de donn√©es</p>
        </div>
        <div style="padding: 1rem; background: white; border-radius: 8px;">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üì±</div>
            <strong>App Event</strong>
            <p style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">√âv√©nement d'une application tierce</p>
        </div>
    </div>
</div>

<!-- Tarification Pipedream -->
<div class="dashboard-card" style="margin-top: 2rem;">
    <h2 style="margin-bottom: 1.5rem;">üí∞ Tarification Pipedream</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; text-align: center;">
            <h3 style="color: #28a745; margin-bottom: 1rem;">Free</h3>
            <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">0‚Ç¨</div>
            <div style="color: #666; margin-bottom: 1rem;">par mois</div>
            <hr style="margin: 1rem 0;">
            <div style="text-align: left; line-height: 2;">
                ‚úì 100 workflows<br>
                ‚úì 10,000 invocations/mois<br>
                ‚úì 1,000+ apps<br>
                ‚úì Support communaut√©
            </div>
        </div>
        <div style="background: #e3f2fd; padding: 1.5rem; border-radius: 10px; text-align: center; border: 2px solid #2196f3;">
            <h3 style="color: #2196f3; margin-bottom: 1rem;">Basic</h3>
            <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">19‚Ç¨</div>
            <div style="color: #666; margin-bottom: 1rem;">par mois</div>
            <hr style="margin: 1rem 0;">
            <div style="text-align: left; line-height: 2;">
                ‚úì Workflows illimit√©s<br>
                ‚úì 100,000 invocations/mois<br>
                ‚úì Support prioritaire<br>
                ‚úì Historique 30 jours
            </div>
        </div>
        <div style="background: #fff3cd; padding: 1.5rem; border-radius: 10px; text-align: center;">
            <h3 style="color: #ffc107; margin-bottom: 1rem;">Advanced</h3>
            <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">49‚Ç¨</div>
            <div style="color: #666; margin-bottom: 1rem;">par mois</div>
            <hr style="margin: 1rem 0;">
            <div style="text-align: left; line-height: 2;">
                ‚úì 1M invocations/mois<br>
                ‚úì Support d√©di√©<br>
                ‚úì SSO & SAML<br>
                ‚úì Historique 90 jours
            </div>
        </div>
    </div>
</div>

<!-- Guide d'int√©gration -->
<div class="dashboard-card" style="background: #e3f2fd; border-left: 4px solid #2196f3; margin-top: 2rem;">
    <h3 style="margin-bottom: 1rem;">üí° Comment cr√©er un workflow ?</h3>
    <ol style="line-height: 2; color: #666;">
        <li>Cliquez sur "Cr√©er un workflow" ou allez sur <a href="https://pipedream.com" target="_blank" style="color: #4169e1; font-weight: 600;">pipedream.com</a></li>
        <li>Choisissez un <strong>trigger</strong> (webhook, email, cron, RSS...)</li>
        <li>Ajoutez des <strong>actions</strong> (appels API, IA, base de donn√©es...)</li>
        <li>Configurez les param√®tres et testez</li>
        <li>Activez le workflow et surveillez les ex√©cutions</li>
    </ol>
</div>

<!-- Modal Cr√©er Workflow -->
<div id="createWorkflowModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>‚ö° Cr√©er un Workflow</h2>
            <button class="modal-close" onclick="closeCreateWorkflowModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="createWorkflowForm" onsubmit="createWorkflow(event)">
                <div class="form-group">
                    <label>Nom du workflow *</label>
                    <input type="text" name="name" required placeholder="Mon workflow automatis√©">
                </div>
                <div class="form-group">
                    <label>Type de trigger *</label>
                    <select name="trigger_type" required>
                        <option value="webhook">üåê Webhook (HTTP)</option>
                        <option value="cron">‚è∞ Cron / Schedule</option>
                        <option value="email">üìß Email</option>
                        <option value="form">üìù Form Submit</option>
                        <option value="database">üìä Database Change</option>
                        <option value="app">üì± App Event</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="3" placeholder="Description de votre workflow..."></textarea>
                </div>
                <div class="form-group">
                    <label>Actions √† effectuer</label>
                    <textarea name="actions" rows="4" placeholder="Ex: Envoyer un email, cr√©er une t√¢che, poster sur les r√©seaux sociaux..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateWorkflowModal()">Annuler</button>
                    <button type="submit" class="btn btn-primary">‚ö° Cr√©er le Workflow</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Modals
function openCreateWorkflowModal() {
    document.getElementById('createWorkflowModal').classList.add('modal-open');
}

function closeCreateWorkflowModal() {
    document.getElementById('createWorkflowModal').classList.remove('modal-open');
    document.getElementById('createWorkflowForm').reset();
}

// Cr√©er workflow
async function createWorkflow(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    
    const workflowData = {
        name: formData.get('name'),
        trigger_type: formData.get('trigger_type'),
        description: formData.get('description'),
        actions: formData.get('actions')
    };
    
    console.log('Cr√©ation du workflow:', workflowData);
    
    // Simulation de cr√©ation
    alert('‚úÖ Workflow cr√©√© avec succ√®s!\n\nPour le moment, cette fonctionnalit√© est en d√©veloppement.\nVous pouvez cr√©er vos workflows directement sur Pipedream.com');
    
    closeCreateWorkflowModal();
}

// Voir workflow
function voirWorkflow(nom) {
    alert('üëÅÔ∏è Workflow: ' + nom + '\n\nD√©tails du workflow...\n\n- Statut: Actif\n- Derni√®re ex√©cution: Il y a 2h\n- Taux de succ√®s: 98%\n\n(Fonctionnalit√© en d√©veloppement)');
}
</script>
{% endblock %}
