{% extends "dashboard/base_dashboard.html" %}

{% block title %}Agents IA - WeBox Studio Cr√©atif{% endblock %}

{% block extra_css %}
<style>
/* Page Header */
.agents-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 2rem;
    border-radius: 20px;
    margin-bottom: 2rem;
    color: white;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.header-subtitle {
    opacity: 0.9;
}

.btn-create-agent {
    background: white;
    color: #667eea;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s;
}

.btn-create-agent:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255, 255, 255, 0.3);
}

/* Filtres */
.agents-filters {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.filter-input {
    flex: 1;
    min-width: 300px;
    padding: 0.75rem 1rem 0.75rem 3rem;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 1rem;
    background: white url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%23666" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>') no-repeat 1rem center;
}

.filter-select {
    padding: 0.75rem 1rem;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 1rem;
    cursor: pointer;
    background: white;
}

/* Agents Grid */
.agents-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
}

.agent-card {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transition: all 0.3s;
    cursor: pointer;
}

.agent-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}

.agent-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.agent-icon {
    font-size: 3rem;
    width: 70px;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    flex-shrink: 0;
}

.agent-info {
    flex: 1;
}

.agent-name {
    font-size: 1.3rem;
    font-weight: 700;
    color: #1a1a2e;
    margin-bottom: 0.25rem;
}

.agent-specialty {
    color: #666;
    font-size: 0.9rem;
}

.agent-description {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 1rem;
    line-height: 1.6;
}

.agent-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 1rem;
}

.agent-tag {
    background: #e3f2fd;
    color: #1976d2;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
}

.agent-stats {
    display: flex;
    justify-content: space-around;
    padding: 1rem 0;
    border-top: 1px solid #e0e0e0;
    border-bottom: 1px solid #e0e0e0;
    margin: 1rem 0;
}

.stat {
    text-align: center;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #667eea;
}

.stat-label {
    font-size: 0.8rem;
    color: #666;
}

.agent-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.status-indicator {
    width: 10px;
    height: 10px;
    border-radius: 50%;
}

.status-active {
    background: #28a745;
}

.status-inactive {
    background: #dc3545;
}

.status-text {
    font-size: 0.9rem;
    font-weight: 600;
}

.agent-actions {
    display: flex;
    gap: 0.5rem;
}

.btn-action {
    flex: 1;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
}

.btn-use {
    background: #4169e1;
    color: white;
}

.btn-use:hover {
    background: #3558c9;
}

.btn-edit {
    background: #28a745;
    color: white;
}

.btn-edit:hover {
    background: #218838;
}

.btn-delete {
    background: #dc3545;
    color: white;
}

.btn-delete:hover {
    background: #c82333;
}

/* √âtat vide */
.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.empty-icon {
    font-size: 5rem;
    margin-bottom: 1rem;
}

.empty-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1a1a2e;
    margin-bottom: 0.5rem;
}

.empty-description {
    color: #666;
    margin-bottom: 2rem;
}

/* Responsive */
@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .agents-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="agents-header">
    <div class="header-content">
        <div>
            <h1 class="header-title">ü§ñ Agents IA Sp√©cialis√©s</h1>
            <p class="header-subtitle">Cr√©ez et g√©rez vos agents IA personnalis√©s</p>
        </div>
        <button class="btn-create-agent" onclick="createAgent()">
            ‚ûï Cr√©er un Agent
        </button>
    </div>
</div>

<!-- Filtres -->
<div class="agents-filters">
    <input type="text" class="filter-input" placeholder="üîç Rechercher un agent..." id="searchInput">
    
    <select class="filter-select" id="specialtyFilter">
        <option value="">Toutes sp√©cialit√©s</option>
        <option value="marketing">Marketing</option>
        <option value="support">Support Client</option>
        <option value="sales">Ventes</option>
        <option value="content">Cr√©ation Contenu</option>
        <option value="analysis">Analyse</option>
        <option value="coding">D√©veloppement</option>
    </select>
    
    <select class="filter-select" id="statusFilter">
        <option value="">Tous statuts</option>
        <option value="active">Actif</option>
        <option value="inactive">Inactif</option>
    </select>
</div>

<!-- Agents Grid -->
<div class="agents-grid" id="agentsGrid">
    <!-- Les agents seront charg√©s ici -->
</div>

<!-- √âtat vide -->
<div class="empty-state hidden" id="emptyState">
    <div class="empty-icon">ü§ñ</div>
    <div class="empty-title">Aucun agent pour le moment</div>
    <div class="empty-description">Cr√©ez votre premier agent IA sp√©cialis√©</div>
    <button class="btn-create-agent" onclick="createAgent()">
        ‚ûï Cr√©er mon premier agent
    </button>
</div>

<script>
let allAgents = [];

// ==================== CHARGEMENT ====================
async function loadAgents() {
    try {
        const response = await fetch('/api/agents');
        const data = await response.json();
        
        allAgents = data.agents || [];
        displayAgents(allAgents);
    } catch (error) {
        console.error('Erreur chargement agents:', error);
        loadDemoAgents();
    }
}

function loadDemoAgents() {
    allAgents = [
        {
            id: 1,
            name: 'Agent Marketing Pro',
            specialty: 'Marketing Digital',
            description: 'Expert en strat√©gies marketing, SEO, publicit√©s et g√©n√©ration de leads. Optimise vos campagnes pour un ROI maximal.',
            tags: ['SEO', 'Ads', 'Content', 'Analytics'],
            status: 'active',
            uses: 1234,
            success_rate: 94,
            icon: 'üìä'
        },
        {
            id: 2,
            name: 'Support Client 24/7',
            specialty: 'Service Client',
            description: 'Agent de support disponible 24/7 pour r√©pondre aux questions clients, g√©rer les tickets et r√©soudre les probl√®mes.',
            tags: ['Support', 'Chat', 'Tickets', 'FAQ'],
            status: 'active',
            uses: 5678,
            success_rate: 98,
            icon: 'üí¨'
        },
        {
            id: 3,
            name: 'Cr√©ateur de Contenu',
            specialty: 'Cr√©ation Contenu',
            description: 'G√©n√®re des articles de blog, posts r√©seaux sociaux, scripts vid√©o et newsletters de qualit√© professionnelle.',
            tags: ['Blog', 'Social', 'Video', 'Email'],
            status: 'active',
            uses: 892,
            success_rate: 91,
            icon: '‚úçÔ∏è'
        },
        {
            id: 4,
            name: 'Analyste de Donn√©es',
            specialty: 'Analyse',
            description: 'Analyse vos donn√©es, g√©n√®re des rapports d√©taill√©s et fournit des insights actionnables pour votre business.',
            tags: ['Analytics', 'Reports', 'Insights', 'KPIs'],
            status: 'active',
            uses: 456,
            success_rate: 96,
            icon: 'üìà'
        },
        {
            id: 5,
            name: 'Assistant D√©veloppeur',
            specialty: 'D√©veloppement',
            description: 'Aide au d√©veloppement, debugging, revue de code et g√©n√©ration de documentation technique.',
            tags: ['Code', 'Debug', 'Review', 'Docs'],
            status: 'inactive',
            uses: 234,
            success_rate: 89,
            icon: 'üíª'
        },
        {
            id: 6,
            name: 'Expert Ventes',
            specialty: 'Ventes',
            description: 'Qualifie les leads, g√®re les relances, cr√©e des propositions commerciales et optimise votre tunnel de vente.',
            tags: ['Leads', 'Sales', 'CRM', 'Proposals'],
            status: 'active',
            uses: 678,
            success_rate: 93,
            icon: 'üíº'
        }
    ];
    
    displayAgents(allAgents);
}

// ==================== AFFICHAGE ====================
function displayAgents(agents) {
    const grid = document.getElementById('agentsGrid');
    const emptyState = document.getElementById('emptyState');
    
    if (agents.length === 0) {
        grid.classList.add('hidden');
        emptyState.classList.remove('hidden');
        return;
    }
    
    grid.classList.remove('hidden');
    emptyState.classList.add('hidden');
    
    grid.innerHTML = agents.map(agent => `
        <div class="agent-card" onclick="openAgent(${agent.id})">
            <div class="agent-header">
                <div class="agent-icon">${agent.icon || 'ü§ñ'}</div>
                <div class="agent-info">
                    <div class="agent-name">${agent.name}</div>
                    <div class="agent-specialty">${agent.specialty}</div>
                </div>
            </div>
            
            <div class="agent-status">
                <div class="status-indicator ${agent.status === 'active' ? 'status-active' : 'status-inactive'}"></div>
                <span class="status-text">${agent.status === 'active' ? 'Actif' : 'Inactif'}</span>
            </div>
            
            <p class="agent-description">${agent.description}</p>
            
            <div class="agent-tags">
                ${agent.tags.map(tag => `<span class="agent-tag">${tag}</span>`).join('')}
            </div>
            
            <div class="agent-stats">
                <div class="stat">
                    <div class="stat-value">${agent.uses}</div>
                    <div class="stat-label">Utilisations</div>
                </div>
                <div class="stat">
                    <div class="stat-value">${agent.success_rate}%</div>
                    <div class="stat-label">Succ√®s</div>
                </div>
            </div>
            
            <div class="agent-actions" onclick="event.stopPropagation()">
                <button class="btn-action btn-use" onclick="useAgent(${agent.id})">Utiliser</button>
                <button class="btn-action btn-edit" onclick="editAgent(${agent.id})">‚úèÔ∏è</button>
                <button class="btn-action btn-delete" onclick="deleteAgent(${agent.id})">üóëÔ∏è</button>
            </div>
        </div>
    `).join('');
}

// ==================== ACTIONS ====================
function createAgent() {
    alert('Cr√©ation d\'agent - √Ä impl√©menter');
}

function openAgent(id) {
    window.location.href = `/agents/${id}`;
}

function useAgent(id) {
    window.location.href = `/chat?agent=${id}`;
}

function editAgent(id) {
    window.location.href = `/agents/${id}/edit`;
}

function deleteAgent(id) {
    if (confirm('√ätes-vous s√ªr de vouloir supprimer cet agent ?')) {
        alert(`Suppression de l'agent ${id} - √Ä impl√©menter`);
    }
}

// ==================== FILTRES ====================
document.getElementById('searchInput').addEventListener('input', filterAgents);
document.getElementById('specialtyFilter').addEventListener('change', filterAgents);
document.getElementById('statusFilter').addEventListener('change', filterAgents);

function filterAgents() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    const specialty = document.getElementById('specialtyFilter').value.toLowerCase();
    const status = document.getElementById('statusFilter').value;
    
    const filtered = allAgents.filter(agent => {
        const matchSearch = agent.name.toLowerCase().includes(search) || 
                          agent.description.toLowerCase().includes(search) ||
                          agent.specialty.toLowerCase().includes(search);
        const matchSpecialty = !specialty || agent.specialty.toLowerCase().includes(specialty);
        const matchStatus = !status || agent.status === status;
        
        return matchSearch && matchSpecialty && matchStatus;
    });
    
    displayAgents(filtered);
}

// Charger au d√©marrage
document.addEventListener('DOMContentLoaded', loadAgents);
</script>
{% endblock %}
