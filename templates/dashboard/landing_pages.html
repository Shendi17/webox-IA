{% extends "dashboard/base_dashboard.html" %}

{% block title %}Landing Pages - WeBox{% endblock %}

{% block extra_css %}
<style>
.creator-card { background: white; border-radius: 15px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
.form-group { display: flex; flex-direction: column; }
.form-group label { font-weight: 600; margin-bottom: 0.5rem; color: #333; }
.form-group input, .form-group select, .form-group textarea { padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; }
.btn-create { background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%); color: white; border: none; padding: 1rem 2rem; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 1.1rem; width: 100%; }
.pages-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem; }
.page-card { background: white; border-radius: 15px; padding: 1.5rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.page-title { font-size: 1.3rem; font-weight: 700; margin-bottom: 0.5rem; }
.page-url { color: #667eea; font-size: 0.9rem; margin-bottom: 1rem; word-break: break-all; }
.page-stats { display: flex; justify-content: space-around; padding: 1rem 0; border-top: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0; margin-bottom: 1rem; }
.stat { text-align: center; }
.stat-value { font-size: 1.5rem; font-weight: 700; color: #667eea; }
.stat-label { font-size: 0.8rem; color: #666; }
.page-actions { display: flex; gap: 0.5rem; }
.btn-publish { background: #28a745; color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; flex: 1; }
.btn-edit { background: #4169e1; color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; flex: 1; }
.btn-delete { background: #dc3545; color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; }
.status-badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
.status-draft { background: #ffc107; color: #000; }
.status-published { background: #28a745; color: white; }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>🌐 Landing Pages</h1>
    <p>Créez des landing pages optimisées pour la conversion</p>
</div>

<!-- Créateur -->
<div class="creator-card">
    <h2>✨ Créer une landing page</h2>
    <div class="form-grid">
        <div class="form-group">
            <label>Nom</label>
            <input type="text" id="pageName" placeholder="Ex: Lancement Produit 2025">
        </div>
        <div class="form-group">
            <label>Template</label>
            <select id="template">
                <option value="saas">SaaS</option>
                <option value="ecommerce">E-commerce</option>
                <option value="agency">Agence</option>
                <option value="event">Événement</option>
                <option value="webinar">Webinaire</option>
            </select>
        </div>
    </div>
    <div class="form-group">
        <label>Titre principal</label>
        <input type="text" id="pageTitle" placeholder="Ex: Transformez votre business avec l'IA">
    </div>
    <div class="form-group">
        <label>Description</label>
        <textarea id="description" rows="3" placeholder="Décrivez votre offre..."></textarea>
    </div>
    <button class="btn-create" onclick="createLandingPage()">🚀 Créer la landing page</button>
</div>

<!-- Liste -->
<h2>📄 Mes landing pages</h2>
<div class="pages-grid" id="pagesGrid"></div>

<script>
let pages = [];

async function createLandingPage() {
    const name = document.getElementById('pageName').value;
    const title = document.getElementById('pageTitle').value;
    
    if (!name || !title) {
        alert('Nom et titre requis');
        return;
    }
    
    try {
        const response = await fetch('/api/landing-pages/create', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                name,
                title,
                description: document.getElementById('description').value,
                template: document.getElementById('template').value,
                colors: ['#667eea', '#764ba2']
            })
        });
        
        const data = await response.json();
        if (data.success) {
            alert(`✅ ${data.message}`);
            document.getElementById('pageName').value = '';
            document.getElementById('pageTitle').value = '';
            document.getElementById('description').value = '';
            await loadPages();
        }
    } catch (error) {
        alert('❌ Erreur');
    }
}

async function loadPages() {
    try {
        const response = await fetch('/api/landing-pages/list');
        const data = await response.json();
        if (data.success) {
            pages = data.landing_pages;
            renderPages();
        }
    } catch (error) {
        console.error('Erreur:', error);
    }
}

function renderPages() {
    const grid = document.getElementById('pagesGrid');
    if (pages.length === 0) {
        grid.innerHTML = '<p style="text-align:center;color:#999;grid-column:1/-1;">Aucune landing page. Créez-en une !</p>';
        return;
    }
    grid.innerHTML = pages.map(p => `
        <div class="page-card">
            <div class="page-title">${p.name}</div>
            <div class="page-url">🔗 ${p.is_published ? p.published_url : `/${p.slug} (brouillon)`}</div>
            <span class="status-badge status-${p.is_published ? 'published' : 'draft'}">
                ${p.is_published ? '✅ Publié' : '📝 Brouillon'}
            </span>
            ${p.is_published ? `
                <div class="page-stats">
                    <div class="stat">
                        <div class="stat-value">${p.views}</div>
                        <div class="stat-label">Vues</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${p.conversions}</div>
                        <div class="stat-label">Conversions</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${p.conversion_rate.toFixed(1)}%</div>
                        <div class="stat-label">Taux</div>
                    </div>
                </div>
            ` : ''}
            <div class="page-actions">
                ${!p.is_published ? `
                    <button class="btn-publish" onclick="publishPage(${p.id})">🚀 Publier</button>
                ` : `
                    <button class="btn-edit" onclick="window.open('${p.published_url}')">👁️ Voir</button>
                `}
                <button class="btn-delete" onclick="deletePage(${p.id})">🗑️</button>
            </div>
        </div>
    `).join('');
}

async function publishPage(id) {
    if (!confirm('Publier cette landing page ?')) return;
    
    try {
        const response = await fetch(`/api/landing-pages/${id}/publish`, { method: 'PUT' });
        const data = await response.json();
        if (data.success) {
            alert(`✅ ${data.message}\n\nURL: ${data.url}`);
            await loadPages();
        }
    } catch (error) {
        alert('❌ Erreur');
    }
}

async function deletePage(id) {
    if (!confirm('Supprimer cette landing page ?')) return;
    
    try {
        const response = await fetch(`/api/landing-pages/${id}`, { method: 'DELETE' });
        const data = await response.json();
        if (data.success) {
            alert('✅ Landing page supprimée');
            await loadPages();
        }
    } catch (error) {
        alert('❌ Erreur');
    }
}

document.addEventListener('DOMContentLoaded', () => {
    loadPages();
});
</script>
{% endblock %}
