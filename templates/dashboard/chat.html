{% extends "dashboard/base_dashboard.html" %}

{% block title %}Chat Multi-IA - WeBox{% endblock %}

{% block extra_css %}
<style>
    .chat-layout {
        display: grid;
        grid-template-columns: 280px 1fr 320px;
        gap: 1.5rem;
        height: calc(100vh - 200px);
    }
    
    .chat-sidebar, .chat-right-panel {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
    }
    
    .new-chat-btn {
        width: 100%;
        padding: 0.75rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        margin-bottom: 1rem;
        transition: all 0.3s;
    }
    
    .new-chat-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }
    
    .chat-history {
        list-style: none;
        padding: 0;
    }
    
    .chat-history-item {
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        background: #f8f9fa;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.9rem;
    }
    
    .chat-history-item:hover {
        background: #e9ecef;
        transform: translateX(5px);
    }
    
    .chat-history-item.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .history-title {
        font-weight: 600;
        margin-bottom: 0.25rem;
    }
    
    .history-time {
        font-size: 0.8rem;
        color: #666;
    }
    
    .chat-history-item.active .history-time {
        color: rgba(255, 255, 255, 0.8);
    }
    
    .chat-main {
        display: flex;
        flex-direction: column;
        background: white;
        border-radius: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .chat-header {
        padding: 1.5rem 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px 15px 0 0;
    }
    
    .model-selector {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
        flex-wrap: wrap;
    }
    
    .model-btn {
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.3s;
    }
    
    .model-btn:hover {
        background: rgba(255, 255, 255, 0.3);
    }
    
    .model-btn.active {
        background: white;
        color: #667eea;
        border-color: white;
    }
    
    .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 2rem;
        background: #f8f9fa;
    }
    
    .message {
        margin-bottom: 1.5rem;
        display: flex;
        gap: 1rem;
    }
    
    .message.user {
        flex-direction: row-reverse;
    }
    
    .message-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        flex-shrink: 0;
    }
    
    .message.user .message-avatar {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .message.ai .message-avatar {
        background: #e9ecef;
    }
    
    .message-content {
        max-width: 70%;
        padding: 1rem 1.5rem;
        border-radius: 15px;
        line-height: 1.6;
    }
    
    .message.user .message-content {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .message.ai .message-content {
        background: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .chat-input-container {
        padding: 1.5rem 2rem;
        background: white;
        border-top: 1px solid #e0e0e0;
        border-radius: 0 0 15px 15px;
    }
    
    .chat-input-wrapper {
        display: flex;
        gap: 1rem;
        align-items: flex-end;
    }
    
    .chat-input {
        flex: 1;
        padding: 1rem;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        resize: none;
        font-family: inherit;
        font-size: 1rem;
        min-height: 60px;
        max-height: 150px;
    }
    
    .chat-input:focus {
        outline: none;
        border-color: #667eea;
    }
    
    .send-btn {
        padding: 1rem 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .send-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }
    
    /* Suggestions Panel */
    .suggestions-section {
        margin-bottom: 2rem;
    }
    
    .section-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #1a1a2e;
        margin-bottom: 1rem;
    }
    
    .suggestion-card {
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 0.75rem;
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid transparent;
    }
    
    .suggestion-card:hover {
        background: white;
        border-color: #667eea;
        transform: translateX(5px);
    }
    
    .suggestion-icon {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
    }
    
    .suggestion-title {
        font-weight: 600;
        margin-bottom: 0.25rem;
        font-size: 0.95rem;
    }
    
    .suggestion-desc {
        font-size: 0.85rem;
        color: #666;
    }
    
    /* Templates */
    .template-card {
        padding: 1rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        margin-bottom: 0.75rem;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .template-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }
    
    .template-title {
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .template-prompt {
        font-size: 0.85rem;
        opacity: 0.9;
        font-style: italic;
    }
    
    .message-hint {
        margin-top: 0.5rem;
        font-size: 0.9rem;
        opacity: 0.8;
    }
    
    .new-chat-btn.danger {
        background: #dc3545;
    }
    
    .new-chat-btn.danger:hover {
        background: #c82333;
        box-shadow: 0 8px 20px rgba(220, 53, 69, 0.3);
    }
    
    /* Stats */
    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
    }
    
    .stat-item {
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
        text-align: center;
    }
    
    .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #667eea;
    }
    
    .stat-label {
        font-size: 0.85rem;
        color: #666;
        margin-top: 0.25rem;
    }
    
    @media (max-width: 1200px) {
        .chat-layout {
            grid-template-columns: 1fr;
        }
        
        .chat-sidebar, .chat-right-panel {
            display: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üí¨ Chat Multi-IA</h1>
    <p>Dialoguez avec GPT-4, Claude 3.5 et Gemini 2.0 Flash</p>
</div>

<div class="chat-layout">
    <!-- Left Sidebar: History -->
    <div class="chat-sidebar">
        <div class="sidebar-header">
            <h2>üí¨ Conversations</h2>
            <button class="new-chat-btn" onclick="newChat()">
                ‚ûï Nouvelle conversation
            </button>
        </div>
        
        <ul class="chat-history" id="chatHistory">
            <li class="chat-history-item active">
                <div class="history-title">Conversation actuelle</div>
                <div class="history-time">Il y a quelques instants</div>
            </li>
            <li class="chat-history-item">
                <div class="history-title">Marketing digital</div>
                <div class="history-time">Il y a 2 heures</div>
            </li>
            <li class="chat-history-item">
                <div class="history-title">Strat√©gie contenu</div>
                <div class="history-time">Hier</div>
            </li>
            <li class="chat-history-item">
                <div class="history-title">Code Python</div>
                <div class="history-time">Il y a 2 jours</div>
            </li>
        </ul>
    </div>
    
    <!-- Main Chat Area -->
    <div class="chat-main">
        <div class="chat-header">
            <h1>üí¨ Chat Multi-IA</h1>
            <div class="model-selector">
                <button class="model-btn active" onclick="selectModel('gemini')">
                    ‚ú® Gemini 2.0 Flash (GRATUIT)
                </button>
                <button class="model-btn" onclick="selectModel('gpt4')">
                    ü§ñ GPT-4
                </button>
                <button class="model-btn" onclick="selectModel('claude')">
                    üß† Claude 3.5
                </button>
            </div>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message ai">
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content">
                    <strong>Gemini 2.0 Flash</strong>
                    <p>Bonjour ! Je suis votre assistant IA. Comment puis-je vous aider aujourd'hui ?</p>
                    <p class="message-hint">üí° Utilisez les suggestions √† droite pour commencer rapidement !</p>
                </div>
            </div>
        </div>
        
        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <textarea 
                    class="chat-input" 
                    id="chatInput" 
                    placeholder="Tapez votre message... (Shift+Enter pour nouvelle ligne)"
                    onkeydown="handleKeyPress(event)"
                ></textarea>
                <button class="send-btn" onclick="sendMessage()">
                    üì§ Envoyer
                </button>
            </div>
        </div>
    </div>
    
    <!-- Right Panel: Suggestions & Templates -->
    <div class="chat-right-panel">
        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value">12</div>
                <div class="stat-label">Conversations</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">156</div>
                <div class="stat-label">Messages</div>
            </div>
        </div>
        
        <!-- Suggestions -->
        <div class="suggestions-section">
            <div class="section-title">üí° Suggestions</div>
            
            <div class="suggestion-card" onclick="useSuggestion('Explique-moi le marketing digital en 3 points cl√©s')">
                <div class="suggestion-icon">üìä</div>
                <div class="suggestion-title">Marketing Digital</div>
                <div class="suggestion-desc">Concepts cl√©s expliqu√©s</div>
            </div>
            
            <div class="suggestion-card" onclick="useSuggestion('√âcris un post LinkedIn engageant sur l\'IA')">
                <div class="suggestion-icon">üì±</div>
                <div class="suggestion-title">Post LinkedIn</div>
                <div class="suggestion-desc">Contenu professionnel</div>
            </div>
            
            <div class="suggestion-card" onclick="useSuggestion('Cr√©e un plan de contenu pour 1 mois')">
                <div class="suggestion-icon">üìÖ</div>
                <div class="suggestion-title">Plan de Contenu</div>
                <div class="suggestion-desc">Strat√©gie mensuelle</div>
            </div>
            
            <div class="suggestion-card" onclick="useSuggestion('Aide-moi √† √©crire un email de prospection')">
                <div class="suggestion-icon">üìß</div>
                <div class="suggestion-title">Email Prospection</div>
                <div class="suggestion-desc">Template professionnel</div>
            </div>
        </div>
        
        <!-- Templates -->
        <div class="suggestions-section">
            <div class="section-title">üìù Templates</div>
            
            <div class="template-card" onclick="useTemplate('article')">
                <div class="template-title">üìÑ Article de Blog</div>
                <div class="template-prompt">"√âcris un article de 800 mots sur [sujet]"</div>
            </div>
            
            <div class="template-card" onclick="useTemplate('description')">
                <div class="template-title">üõçÔ∏è Description Produit</div>
                <div class="template-prompt">"Cr√©e une description de produit pour [produit]"</div>
            </div>
            
            <div class="template-card" onclick="useTemplate('script')">
                <div class="template-title">üé¨ Script Vid√©o</div>
                <div class="template-prompt">"√âcris un script vid√©o de 2 min sur [sujet]"</div>
            </div>
            
            <div class="template-card" onclick="useTemplate('code')">
                <div class="template-title">üíª Code</div>
                <div class="template-prompt">"√âcris du code [langage] pour [fonctionnalit√©]"</div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="suggestions-section">
            <div class="section-title">‚ö° Actions rapides</div>
            <button class="new-chat-btn" onclick="exportChat()">
                üì• Exporter conversation
            </button>
            <button class="new-chat-btn danger" onclick="clearChat()">
                üóëÔ∏è Effacer conversation
            </button>
        </div>
    </div>
</div>

<script>
let currentModel = 'gemini';

function selectModel(model) {
    currentModel = model;
    document.querySelectorAll('.model-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    const modelNames = {
        'gemini': 'Gemini 2.0 Flash',
        'gpt4': 'GPT-4',
        'claude': 'Claude 3.5'
    };
    
    addMessage('ai', `Mod√®le chang√© vers ${modelNames[model]} !`);
}

function newChat() {
    if (confirm('Cr√©er une nouvelle conversation ?')) {
        document.getElementById('chatMessages').innerHTML = `
            <div class="message ai">
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content">
                    <strong>Gemini 2.0 Flash</strong>
                    <p>Nouvelle conversation ! Comment puis-je vous aider ?</p>
                </div>
            </div>
        `;
    }
}

function sendMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    addMessage('user', message);
    input.value = '';
    
    // Simuler r√©ponse IA
    setTimeout(() => {
        addMessage('ai', 'R√©ponse de l\'IA en cours de g√©n√©ration... (√Ä impl√©menter avec l\'API)');
    }, 500);
}

function addMessage(type, content) {
    const messagesContainer = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type}`;
    
    const avatar = type === 'user' ? 'üë§' : 'ü§ñ';
    const modelName = type === 'ai' ? getModelName() : '';
    
    messageDiv.innerHTML = `
        <div class="message-avatar">${avatar}</div>
        <div class="message-content">
            ${modelName ? `<strong>${modelName}</strong>` : ''}
            <p>${content}</p>
        </div>
    `;
    
    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function getModelName() {
    const names = {
        'gemini': 'Gemini 2.0 Flash',
        'gpt4': 'GPT-4',
        'claude': 'Claude 3.5'
    };
    return names[currentModel];
}

function handleKeyPress(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
    }
}

function useSuggestion(text) {
    document.getElementById('chatInput').value = text;
    document.getElementById('chatInput').focus();
}

function useTemplate(type) {
    const templates = {
        'article': '√âcris un article de blog de 800 mots sur [ton sujet]. Inclus une introduction accrocheuse, 3 sections principales avec des sous-titres, et une conclusion avec un appel √† l\'action.',
        'description': 'Cr√©e une description de produit convaincante pour [nom du produit]. Mets en avant les b√©n√©fices cl√©s, les caract√©ristiques uniques, et inclus un appel √† l\'action.',
        'script': '√âcris un script vid√©o de 2 minutes sur [ton sujet]. Structure : accroche (10s), probl√®me (30s), solution (60s), appel √† l\'action (20s).',
        'code': '√âcris du code [langage] pour [fonctionnalit√©]. Inclus des commentaires explicatifs et des bonnes pratiques.'
    };
    
    document.getElementById('chatInput').value = templates[type];
    document.getElementById('chatInput').focus();
}

function exportChat() {
    alert('Export de la conversation... (√Ä impl√©menter)');
}

function clearChat() {
    if (confirm('Effacer toute la conversation ?')) {
        newChat();
    }
}
</script>
{% endblock %}
